#!/usr/bin/env bash

#Confidence interval
CONF=0.95
#Accuracy
ACC=5
#Expected number of runs
NRUNS=5

for folder in ycsb/* ; do
	fthr=data${folder:4}_throughput.dat
    flat=data${folder:4}_latencies.dat
    
    awk -f stats.awk $folder/*.dat


    ./confbounds.py throughputs.dat $CONF $ACC $NRUNS | sort -k 1 -g > $fthr
    ./confbounds.py latencies.dat $CONF $ACC $NRUNS | sort -k 1 -g > $flat

    cat $flat | tail -n +2 | awk '{print $2, $3, $4}' > lat.tmp
    cat $fthr | tail -n +2 | awk '{print $2}' > thr.tmp
    paste thr.tmp lat.tmp > data/${folder:4}_thrvlat.dat

    rm thr.tmp
    rm lat.tmp

    # generated by stats.awk script
    rm throughputs.dat
    rm latencies.dat
done

gnuplot equality.gp