#!/bin/awk -f

BEGIN {
	OFS = ","

	#Stores all of the operations average latencies
	#The array keys have the following syntax: OP,size,run

	latencies[""] = 0
	counter = 0 
	cfile= ""
	maxcounter = 0
}
{
	if(length(cfile) == 0 || cfile != FILENAME){
		cfile = FILENAME
		maxcounter = counter
		counter = 0
	}
	
	nparts = split(FILENAME, nameb, "_")

	if(nparts < 0 || nparts > 6){
		printf "Input files name does not have recommended syntax."
		exit 1
	}

	run = nameb[3]
	key = run","counter
	latencies[key] = $2*0.001
	counter += 10 #Time frame jumps from 10 in 10 seconds
	runs[run] = 1

}
END{
	if (maxcounter == 0){
		print "Test if input was generated byHistogramLogProcessor ", FILENAME
		exit 1
	}

	presults(latencies, "percentiles.dat")

}
# function to print results in the end after processing the input files
function presults(metric, filename){
	# Output READ average latency
	for(i = 0; i < maxcounter; i+=10){
		printf "%5d", i >> filename
		for(run in runs){
			key = run","i
			printf "\t%6.2f", metric[key] >> filename
		}
		printf "\n" >> filename
	}
}